import asyncio
import json
import websockets

# ‚úÖ ÌÖåÏä§Ìä∏Ìï† WebSocket ÏÑúÎ≤Ñ Ï£ºÏÜå
WEBSOCKET_URL = "ws://localhost:8000/focus"

# ‚úÖ Ï†ïÌôïÌïú ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞
TEST_PAYLOAD = {
        "timestamp": 1739238238,
        "frame_data": [
            {
                "frame_index": 33,
                "head_x": 0.5010841488838196,
                "head_y": 0.5906621813774109,
                "neck_x": 0.5625308156013489,
                "neck_y": 0.47754040360450745,
                "shoulder_left_x": 0.8658264875411987,
                "shoulder_left_y": 1.0250250101089478,
                "shoulder_right_x": 0.15071026980876923,
                "shoulder_right_y": 0.9440329074859619,
                "elbow_left_x": 0.9715188145637512,
                "elbow_left_y": 1.6059966087341309,
                "elbow_right_x": 0.0012500591110438108,
                "elbow_right_y": 1.6011278629302979,
                "wrist_left_x": 0.8868176341056824,
                "wrist_left_y": 1.9982470273971558,
                "wrist_right_x": 0.08270348608493805,
                "wrist_right_y": 1.9996305704116821,
                "head_tilt": 0.11312177777290344,
                "eye_direction": 0.483041912317276,
                "phone_detected": 0
            },
            {
                "frame_index": 34,
                "head_x": 0.5012614727020264,
                "head_y": 0.5915709137916565,
                "neck_x": 0.5626623630523682,
                "neck_y": 0.4779264032840729,
                "shoulder_left_x": 0.8660546541213989,
                "shoulder_left_y": 1.0256167650222778,
                "shoulder_right_x": 0.1508297622203827,
                "shoulder_right_y": 0.9439961314201355,
                "elbow_left_x": 0.9708356857299805,
                "elbow_left_y": 1.606174349784851,
                "elbow_right_x": 0.0031649302691221237,
                "elbow_right_y": 1.6028069257736206,
                "wrist_left_x": 0.8865283727645874,
                "wrist_left_y": 1.998293161392212,
                "wrist_right_x": 0.08377748727798462,
                "wrist_right_y": 2.008547782897949,
                "head_tilt": 0.11364451050758362,
                "eye_direction": 0.48690858483314514,
                "phone_detected": 0
            },
            {
                "frame_index": 35,
                "head_x": 0.5015685558319092,
                "head_y": 0.5915552973747253,
                "neck_x": 0.5629643797874451,
                "neck_y": 0.47787779569625854,
                "shoulder_left_x": 0.8655778169631958,
                "shoulder_left_y": 1.0255848169326782,
                "shoulder_right_x": 0.1510612517595291,
                "shoulder_right_y": 0.9439799785614014,
                "elbow_left_x": 0.9707468152046204,
                "elbow_left_y": 1.6079423427581787,
                "elbow_right_x": 0.003631138475611806,
                "elbow_right_y": 1.6044856309890747,
                "wrist_left_x": 0.8864494562149048,
                "wrist_left_y": 1.9983235597610474,
                "wrist_right_x": 0.08893745392560959,
                "wrist_right_y": 2.008962869644165,
                "head_tilt": 0.1136775016784668,
                "eye_direction": 0.4867902100086212,
                "phone_detected": 0
            },
            {
                "frame_index": 36,
                "head_x": 0.5023093819618225,
                "head_y": 0.592232346534729,
                "neck_x": 0.563403844833374,
                "neck_y": 0.47822898626327515,
                "shoulder_left_x": 0.8658083081245422,
                "shoulder_left_y": 1.025573968887329,
                "shoulder_right_x": 0.15104940533638,
                "shoulder_right_y": 0.94418865442276,
                "elbow_left_x": 0.9718115925788879,
                "elbow_left_y": 1.608001470565796,
                "elbow_right_x": 0.0030980552546679974,
                "elbow_right_y": 1.6052250862121582,
                "wrist_left_x": 0.8866479992866516,
                "wrist_left_y": 1.9984902143478394,
                "wrist_right_x": 0.08858027309179306,
                "wrist_right_y": 2.0169217586517334,
                "head_tilt": 0.11400336027145386,
                "eye_direction": 0.4839458763599396,
                "phone_detected": 0
            },
            {
                "frame_index": 37,
                "head_x": 0.5026947259902954,
                "head_y": 0.5922483205795288,
                "neck_x": 0.5636501312255859,
                "neck_y": 0.4782528877258301,
                "shoulder_left_x": 0.8657174110412598,
                "shoulder_left_y": 1.0257831811904907,
                "shoulder_right_x": 0.15089716017246246,
                "shoulder_right_y": 0.9449278116226196,
                "elbow_left_x": 0.9662138819694519,
                "elbow_left_y": 1.6102126836776733,
                "elbow_right_x": 0.002718715462833643,
                "elbow_right_y": 1.6080530881881714,
                "wrist_left_x": 0.882915198802948,
                "wrist_left_y": 2.0012717247009277,
                "wrist_right_x": 0.0887327790260315,
                "wrist_right_y": 2.0238451957702637,
                "head_tilt": 0.11399543285369873,
                "eye_direction": 0.4884463846683502,
                "phone_detected": 0
            },
            {
                "frame_index": 38,
                "head_x": 0.5031982064247131,
                "head_y": 0.592259407043457,
                "neck_x": 0.5638711452484131,
                "neck_y": 0.4782496392726898,
                "shoulder_left_x": 0.8657147288322449,
                "shoulder_left_y": 1.0258214473724365,
                "shoulder_right_x": 0.14809831976890564,
                "shoulder_right_y": 0.947886049747467,
                "elbow_left_x": 0.9650079607963562,
                "elbow_left_y": 1.6124138832092285,
                "elbow_right_x": -0.014736947603523731,
                "elbow_right_y": 1.6085177659988403,
                "wrist_left_x": 0.8833034634590149,
                "wrist_left_y": 2.007016658782959,
                "wrist_right_x": 0.07738830894231796,
                "wrist_right_y": 2.0341310501098633,
                "head_tilt": 0.11400976777076721,
                "eye_direction": 0.4856269359588623,
                "phone_detected": 0
            },
            {
                "frame_index": 39,
                "head_x": 0.5030001401901245,
                "head_y": 0.5927606225013733,
                "neck_x": 0.5637158155441284,
                "neck_y": 0.4785747230052948,
                "shoulder_left_x": 0.8657060861587524,
                "shoulder_left_y": 1.025794506072998,
                "shoulder_right_x": 0.14807425439357758,
                "shoulder_right_y": 0.94893878698349,
                "elbow_left_x": 0.9645037651062012,
                "elbow_left_y": 1.6136362552642822,
                "elbow_right_x": -0.014166494831442833,
                "elbow_right_y": 1.6092559099197388,
                "wrist_left_x": 0.8836784362792969,
                "wrist_left_y": 2.0093636512756348,
                "wrist_right_x": 0.07742159068584442,
                "wrist_right_y": 2.0381600856781006,
                "head_tilt": 0.11418589949607849,
                "eye_direction": 0.4866221249103546,
                "phone_detected": 0
            },
            {
                "frame_index": 40,
                "head_x": 0.5030079483985901,
                "head_y": 0.5953854322433472,
                "neck_x": 0.5636905431747437,
                "neck_y": 0.4804171025753021,
                "shoulder_left_x": 0.8648191690444946,
                "shoulder_left_y": 1.0245779752731323,
                "shoulder_right_x": 0.14810016751289368,
                "shoulder_right_y": 0.9493587613105774,
                "elbow_left_x": 0.963357150554657,
                "elbow_left_y": 1.6136659383773804,
                "elbow_right_x": -0.013927984051406384,
                "elbow_right_y": 1.6058074235916138,
                "wrist_left_x": 0.8834651112556458,
                "wrist_left_y": 2.0092673301696777,
                "wrist_right_x": 0.0767534077167511,
                "wrist_right_y": 2.0343194007873535,
                "head_tilt": 0.11496832966804504,
                "eye_direction": 0.48555564880371094,
                "phone_detected": 0
            },
            {
                "frame_index": 41,
                "head_x": 0.5029821395874023,
                "head_y": 0.595521092414856,
                "neck_x": 0.5635839700698853,
                "neck_y": 0.4804847538471222,
                "shoulder_left_x": 0.8651749491691589,
                "shoulder_left_y": 1.0246392488479614,
                "shoulder_right_x": 0.14576953649520874,
                "shoulder_right_y": 0.9527584910392761,
                "elbow_left_x": 0.9632821083068848,
                "elbow_left_y": 1.6165348291397095,
                "elbow_right_x": -0.01720545068383217,
                "elbow_right_y": 1.6058446168899536,
                "wrist_left_x": 0.8851708173751831,
                "wrist_left_y": 2.0117523670196533,
                "wrist_right_x": 0.06497734040021896,
                "wrist_right_y": 2.0371997356414795,
                "head_tilt": 0.11503633856773376,
                "eye_direction": 0.48536843061447144,
                "phone_detected": 0
            },
            {
                "frame_index": 42,
                "head_x": 0.5026599168777466,
                "head_y": 0.596763014793396,
                "neck_x": 0.562854528427124,
                "neck_y": 0.48098859190940857,
                "shoulder_left_x": 0.8651402592658997,
                "shoulder_left_y": 1.024607539176941,
                "shoulder_right_x": 0.14629122614860535,
                "shoulder_right_y": 0.9513570070266724,
                "elbow_left_x": 0.9611650705337524,
                "elbow_left_y": 1.6165621280670166,
                "elbow_right_x": -0.024864932522177696,
                "elbow_right_y": 1.5981717109680176,
                "wrist_left_x": 0.8855161666870117,
                "wrist_left_y": 2.019357204437256,
                "wrist_right_x": 0.05611012130975723,
                "wrist_right_y": 2.0304460525512695,
                "head_tilt": 0.11577442288398743,
                "eye_direction": 0.4889146387577057,
                "phone_detected": 0
            },
            {
                "frame_index": 43,
                "head_x": 0.5016632080078125,
                "head_y": 0.5965626835823059,
                "neck_x": 0.5613546967506409,
                "neck_y": 0.4808921217918396,
                "shoulder_left_x": 0.8637946248054504,
                "shoulder_left_y": 1.0224586725234985,
                "shoulder_right_x": 0.15087181329727173,
                "shoulder_right_y": 0.9482523798942566,
                "elbow_left_x": 0.9561129808425903,
                "elbow_left_y": 1.6123753786087036,
                "elbow_right_x": -0.02415378764271736,
                "elbow_right_y": 1.5786941051483154,
                "wrist_left_x": 0.885224461555481,
                "wrist_left_y": 2.013829469680786,
                "wrist_right_x": 0.056814245879650116,
                "wrist_right_y": 2.0052976608276367,
                "head_tilt": 0.11567056179046631,
                "eye_direction": 0.49046653509140015,
                "phone_detected": 0
            },
            {
                "frame_index": 44,
                "head_x": 0.5008435249328613,
                "head_y": 0.595754086971283,
                "neck_x": 0.5605999231338501,
                "neck_y": 0.47983318567276,
                "shoulder_left_x": 0.8633475303649902,
                "shoulder_left_y": 1.0219287872314453,
                "shoulder_right_x": 0.15136674046516418,
                "shoulder_right_y": 0.9464927911758423,
                "elbow_left_x": 0.955315887928009,
                "elbow_left_y": 1.6124309301376343,
                "elbow_right_x": -0.02476004883646965,
                "elbow_right_y": 1.5740816593170166,
                "wrist_left_x": 0.8853963017463684,
                "wrist_left_y": 2.0169942378997803,
                "wrist_right_x": 0.056216128170490265,
                "wrist_right_y": 2.002028226852417,
                "head_tilt": 0.11592090129852295,
                "eye_direction": 0.4922332167625427,
                "phone_detected": 0
            },
            {
                "frame_index": 45,
                "head_x": 0.5002416372299194,
                "head_y": 0.5941638946533203,
                "neck_x": 0.5602700710296631,
                "neck_y": 0.47862523794174194,
                "shoulder_left_x": 0.8629864454269409,
                "shoulder_left_y": 1.0218555927276611,
                "shoulder_right_x": 0.15144476294517517,
                "shoulder_right_y": 0.9429837465286255,
                "elbow_left_x": 0.9547009468078613,
                "elbow_left_y": 1.6121602058410645,
                "elbow_right_x": -0.030366212129592896,
                "elbow_right_y": 1.5587657690048218,
                "wrist_left_x": 0.8845747709274292,
                "wrist_left_y": 2.010573625564575,
                "wrist_right_x": 0.041137345135211945,
                "wrist_right_y": 1.9890238046646118,
                "head_tilt": 0.11553865671157837,
                "eye_direction": 0.4927288591861725,
                "phone_detected": 0
            },
            {
                "frame_index": 46,
                "head_x": 0.5009851455688477,
                "head_y": 0.5946573615074158,
                "neck_x": 0.5605977773666382,
                "neck_y": 0.47888606786727905,
                "shoulder_left_x": 0.8621363639831543,
                "shoulder_left_y": 1.0203500986099243,
                "shoulder_right_x": 0.15275730192661285,
                "shoulder_right_y": 0.9426332116127014,
                "elbow_left_x": 0.954738974571228,
                "elbow_left_y": 1.6081849336624146,
                "elbow_right_x": -0.030689626932144165,
                "elbow_right_y": 1.557634711265564,
                "wrist_left_x": 0.8846234083175659,
                "wrist_left_y": 1.9997525215148926,
                "wrist_right_x": 0.042113419622182846,
                "wrist_right_y": 1.9738308191299438,
                "head_tilt": 0.11577129364013672,
                "eye_direction": 0.4896993935108185,
                "phone_detected": 0
            }
        ],
        "phone_detected_percentage": 0.0,
        "head_tilt": 0.11466562535081591,
        "eye_direction": 0.48759633941309793
}

async def test_websocket():
    async with websockets.connect(WEBSOCKET_URL) as ws:
        print("‚úÖ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ")

        # ‚úÖ Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
        await ws.send(json.dumps(TEST_PAYLOAD))
        print("üì° Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° ÏôÑÎ£å:", TEST_PAYLOAD)

        # ‚úÖ ÏÑúÎ≤Ñ ÏùëÎãµ ÌôïÏù∏
        response = await ws.recv()
        result = json.loads(response)
        print("üì° ÏÑúÎ≤Ñ ÏùëÎãµ:", result)

        assert "focus_prediction" in result  # üî• ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù
        assert result["focus_prediction"] in [0, 1]  # üî• 0 ÎòêÎäî 1Ïù∏ÏßÄ ÌôïÏù∏

# ‚úÖ ÌÖåÏä§Ìä∏ Ïã§Ìñâ
if __name__ == "__main__":
    asyncio.run(test_websocket())
