import sys
import os

# ‚úÖ backend Ìè¥ÎçîÎ•º sys.pathÏóê Ï∂îÍ∞Ä
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

# ‚úÖ Î™®Îç∏ ÏòàÏ∏° Ìï®Ïàò Í∞ÄÏ†∏Ïò§Í∏∞
from models.predict import predict_focus  # üî• preprocess_input Ï†úÍ±∞ (predict_focusÏóêÏÑú ÏûêÎèô Ï≤òÎ¶¨)

# ‚úÖ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ (üî• Ïã§Ï†ú ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ÏôÄ ÎèôÏùºÌïú Íµ¨Ï°∞)
TEST_PAYLOAD =      {
        "timestamp": 1739238237,
        "frame_data": [
            {
                "frame_index": 18,
                "head_x": 0.4976748526096344,
                "head_y": 0.5792549848556519,
                "neck_x": 0.563123345375061,
                "neck_y": 0.47296011447906494,
                "shoulder_left_x": 0.8614859580993652,
                "shoulder_left_y": 1.040179967880249,
                "shoulder_right_x": 0.1525028645992279,
                "shoulder_right_y": 0.9568173885345459,
                "elbow_left_x": 0.9491060376167297,
                "elbow_left_y": 1.6509395837783813,
                "elbow_right_x": 0.009579353034496307,
                "elbow_right_y": 1.612656831741333,
                "wrist_left_x": 0.8879182934761047,
                "wrist_left_y": 2.03657603263855,
                "wrist_right_x": 0.06457866728305817,
                "wrist_right_y": 2.0114901065826416,
                "head_tilt": 0.10629487037658691,
                "eye_direction": 0.4836753010749817,
                "phone_detected": 0
            },
            {
                "frame_index": 19,
                "head_x": 0.4980839192867279,
                "head_y": 0.5804073214530945,
                "neck_x": 0.5633113980293274,
                "neck_y": 0.4731830656528473,
                "shoulder_left_x": 0.8615508079528809,
                "shoulder_left_y": 1.039840579032898,
                "shoulder_right_x": 0.15238019824028015,
                "shoulder_right_y": 0.9570278525352478,
                "elbow_left_x": 0.9519826173782349,
                "elbow_left_y": 1.6505144834518433,
                "elbow_right_x": 0.008131287060678005,
                "elbow_right_y": 1.6167457103729248,
                "wrist_left_x": 0.8876178860664368,
                "wrist_left_y": 2.0332462787628174,
                "wrist_right_x": 0.058486729860305786,
                "wrist_right_y": 2.011715888977051,
                "head_tilt": 0.10722425580024719,
                "eye_direction": 0.4844833016395569,
                "phone_detected": 0
            },
            {
                "frame_index": 20,
                "head_x": 0.4996613562107086,
                "head_y": 0.5808459520339966,
                "neck_x": 0.5644243359565735,
                "neck_y": 0.4731205105781555,
                "shoulder_left_x": 0.8628886938095093,
                "shoulder_left_y": 1.0372092723846436,
                "shoulder_right_x": 0.15134695172309875,
                "shoulder_right_y": 0.9571173191070557,
                "elbow_left_x": 0.9612689018249512,
                "elbow_left_y": 1.6502593755722046,
                "elbow_right_x": 0.0039051033090800047,
                "elbow_right_y": 1.6189978122711182,
                "wrist_left_x": 0.8893691301345825,
                "wrist_left_y": 2.0331947803497314,
                "wrist_right_x": 0.05641678720712662,
                "wrist_right_y": 2.011857748031616,
                "head_tilt": 0.10772544145584106,
                "eye_direction": 0.4829167425632477,
                "phone_detected": 0
            },
            {
                "frame_index": 21,
                "head_x": 0.4999234080314636,
                "head_y": 0.5811751484870911,
                "neck_x": 0.564577579498291,
                "neck_y": 0.4730326235294342,
                "shoulder_left_x": 0.8641840815544128,
                "shoulder_left_y": 1.0362491607666016,
                "shoulder_right_x": 0.1503003090620041,
                "shoulder_right_y": 0.9562028050422668,
                "elbow_left_x": 0.9629043340682983,
                "elbow_left_y": 1.649224877357483,
                "elbow_right_x": 0.0006579897017218173,
                "elbow_right_y": 1.6196086406707764,
                "wrist_left_x": 0.8891652822494507,
                "wrist_left_y": 2.0333142280578613,
                "wrist_right_x": 0.058940522372722626,
                "wrist_right_y": 2.039005756378174,
                "head_tilt": 0.10814252495765686,
                "eye_direction": 0.4861442446708679,
                "phone_detected": 0
            },
            {
                "frame_index": 22,
                "head_x": 0.500020444393158,
                "head_y": 0.5825556516647339,
                "neck_x": 0.5646096467971802,
                "neck_y": 0.47327762842178345,
                "shoulder_left_x": 0.864172637462616,
                "shoulder_left_y": 1.03578519821167,
                "shoulder_right_x": 0.15025529265403748,
                "shoulder_right_y": 0.9556010961532593,
                "elbow_left_x": 0.9629670977592468,
                "elbow_left_y": 1.648829698562622,
                "elbow_right_x": 0.0008866853313520551,
                "elbow_right_y": 1.6215121746063232,
                "wrist_left_x": 0.8892707824707031,
                "wrist_left_y": 2.030410051345825,
                "wrist_right_x": 0.06690557301044464,
                "wrist_right_y": 2.0436110496520996,
                "head_tilt": 0.10927802324295044,
                "eye_direction": 0.48313313722610474,
                "phone_detected": 0
            },
            {
                "frame_index": 23,
                "head_x": 0.5001918077468872,
                "head_y": 0.5825940370559692,
                "neck_x": 0.5646355152130127,
                "neck_y": 0.4730847477912903,
                "shoulder_left_x": 0.8650335073471069,
                "shoulder_left_y": 1.0345360040664673,
                "shoulder_right_x": 0.15025527775287628,
                "shoulder_right_y": 0.9553611278533936,
                "elbow_left_x": 0.9629322290420532,
                "elbow_left_y": 1.6427597999572754,
                "elbow_right_x": 0.005311886314302683,
                "elbow_right_y": 1.6224409341812134,
                "wrist_left_x": 0.8887045979499817,
                "wrist_left_y": 2.026412010192871,
                "wrist_right_x": 0.07669755816459656,
                "wrist_right_y": 2.049755096435547,
                "head_tilt": 0.10950928926467896,
                "eye_direction": 0.4865838587284088,
                "phone_detected": 0
            },
            {
                "frame_index": 24,
                "head_x": 0.5001643896102905,
                "head_y": 0.5826230645179749,
                "neck_x": 0.5644636750221252,
                "neck_y": 0.47295185923576355,
                "shoulder_left_x": 0.8658105134963989,
                "shoulder_left_y": 1.033631443977356,
                "shoulder_right_x": 0.1501370072364807,
                "shoulder_right_y": 0.9522921442985535,
                "elbow_left_x": 0.9630538821220398,
                "elbow_left_y": 1.6413016319274902,
                "elbow_right_x": 0.004489695653319359,
                "elbow_right_y": 1.6218044757843018,
                "wrist_left_x": 0.8885895609855652,
                "wrist_left_y": 2.0261404514312744,
                "wrist_right_x": 0.08001898974180222,
                "wrist_right_y": 2.0487582683563232,
                "head_tilt": 0.1096712052822113,
                "eye_direction": 0.48482686281204224,
                "phone_detected": 0
            },
            {
                "frame_index": 25,
                "head_x": 0.5000326633453369,
                "head_y": 0.5826415419578552,
                "neck_x": 0.5641361474990845,
                "neck_y": 0.47290322184562683,
                "shoulder_left_x": 0.8658976554870605,
                "shoulder_left_y": 1.0320110321044922,
                "shoulder_right_x": 0.15011835098266602,
                "shoulder_right_y": 0.9516540169715881,
                "elbow_left_x": 0.9661042094230652,
                "elbow_left_y": 1.6280710697174072,
                "elbow_right_x": 0.00426199147477746,
                "elbow_right_y": 1.6159498691558838,
                "wrist_left_x": 0.888888955116272,
                "wrist_left_y": 2.0162384510040283,
                "wrist_right_x": 0.08211065828800201,
                "wrist_right_y": 2.04567551612854,
                "head_tilt": 0.1097383201122284,
                "eye_direction": 0.48472192883491516,
                "phone_detected": 0
            },
            {
                "frame_index": 26,
                "head_x": 0.4999900758266449,
                "head_y": 0.5826396942138672,
                "neck_x": 0.5638092756271362,
                "neck_y": 0.4727809727191925,
                "shoulder_left_x": 0.8664050102233887,
                "shoulder_left_y": 1.030592918395996,
                "shoulder_right_x": 0.14956428110599518,
                "shoulder_right_y": 0.949863612651825,
                "elbow_left_x": 0.9675617218017578,
                "elbow_left_y": 1.6258127689361572,
                "elbow_right_x": -0.0008734065922908485,
                "elbow_right_y": 1.6116745471954346,
                "wrist_left_x": 0.8888487815856934,
                "wrist_left_y": 2.0145204067230225,
                "wrist_right_x": 0.05834277346730232,
                "wrist_right_y": 1.997310757637024,
                "head_tilt": 0.10985872149467468,
                "eye_direction": 0.48690852522850037,
                "phone_detected": 0
            },
            {
                "frame_index": 27,
                "head_x": 0.500036358833313,
                "head_y": 0.582680881023407,
                "neck_x": 0.5637122392654419,
                "neck_y": 0.4727664589881897,
                "shoulder_left_x": 0.8664616346359253,
                "shoulder_left_y": 1.0294220447540283,
                "shoulder_right_x": 0.14885585010051727,
                "shoulder_right_y": 0.9495400190353394,
                "elbow_left_x": 0.9672104120254517,
                "elbow_left_y": 1.6246646642684937,
                "elbow_right_x": -0.0007749092765152454,
                "elbow_right_y": 1.6116230487823486,
                "wrist_left_x": 0.8877053260803223,
                "wrist_left_y": 2.0132946968078613,
                "wrist_right_x": 0.05394534021615982,
                "wrist_right_y": 1.9872422218322754,
                "head_tilt": 0.10991442203521729,
                "eye_direction": 0.48554036021232605,
                "phone_detected": 0
            },
            {
                "frame_index": 28,
                "head_x": 0.4999064803123474,
                "head_y": 0.5835044980049133,
                "neck_x": 0.5630683898925781,
                "neck_y": 0.47319504618644714,
                "shoulder_left_x": 0.8664625883102417,
                "shoulder_left_y": 1.0293375253677368,
                "shoulder_right_x": 0.14883220195770264,
                "shoulder_right_y": 0.9475787878036499,
                "elbow_left_x": 0.9691520929336548,
                "elbow_left_y": 1.6236375570297241,
                "elbow_right_x": -0.003229856491088867,
                "elbow_right_y": 1.6098411083221436,
                "wrist_left_x": 0.8877681493759155,
                "wrist_left_y": 2.012397289276123,
                "wrist_right_x": 0.059356361627578735,
                "wrist_right_y": 1.9931679964065552,
                "head_tilt": 0.11030945181846619,
                "eye_direction": 0.4844379127025604,
                "phone_detected": 0
            },
            {
                "frame_index": 29,
                "head_x": 0.49962282180786133,
                "head_y": 0.5864219665527344,
                "neck_x": 0.5619789361953735,
                "neck_y": 0.47519174218177795,
                "shoulder_left_x": 0.8664535284042358,
                "shoulder_left_y": 1.028534173965454,
                "shoulder_right_x": 0.14887887239456177,
                "shoulder_right_y": 0.9460923671722412,
                "elbow_left_x": 0.9703865051269531,
                "elbow_left_y": 1.6217479705810547,
                "elbow_right_x": -0.005304071120917797,
                "elbow_right_y": 1.6048957109451294,
                "wrist_left_x": 0.8874685168266296,
                "wrist_left_y": 2.012167453765869,
                "wrist_right_x": 0.06228915601968765,
                "wrist_right_y": 1.994322657585144,
                "head_tilt": 0.11123022437095642,
                "eye_direction": 0.4859597086906433,
                "phone_detected": 0
            },
            {
                "frame_index": 30,
                "head_x": 0.4996630549430847,
                "head_y": 0.5886686444282532,
                "neck_x": 0.561936616897583,
                "neck_y": 0.4764927923679352,
                "shoulder_left_x": 0.8659719228744507,
                "shoulder_left_y": 1.026214599609375,
                "shoulder_right_x": 0.14876051247119904,
                "shoulder_right_y": 0.9458340406417847,
                "elbow_left_x": 0.9723366498947144,
                "elbow_left_y": 1.6170592308044434,
                "elbow_right_x": -0.006422752980142832,
                "elbow_right_y": 1.6044591665267944,
                "wrist_left_x": 0.8877776265144348,
                "wrist_left_y": 2.0061423778533936,
                "wrist_right_x": 0.06928033381700516,
                "wrist_right_y": 1.9946563243865967,
                "head_tilt": 0.112175852060318,
                "eye_direction": 0.48715871572494507,
                "phone_detected": 0
            },
            {
                "frame_index": 31,
                "head_x": 0.5002435445785522,
                "head_y": 0.5890005826950073,
                "neck_x": 0.5620917081832886,
                "neck_y": 0.4765389859676361,
                "shoulder_left_x": 0.865916907787323,
                "shoulder_left_y": 1.0254839658737183,
                "shoulder_right_x": 0.14870518445968628,
                "shoulder_right_y": 0.9445046186447144,
                "elbow_left_x": 0.9722763299942017,
                "elbow_left_y": 1.6067478656768799,
                "elbow_right_x": -0.006370821036398411,
                "elbow_right_y": 1.6038061380386353,
                "wrist_left_x": 0.8877353668212891,
                "wrist_left_y": 1.9989570379257202,
                "wrist_right_x": 0.07745206356048584,
                "wrist_right_y": 1.9983627796173096,
                "head_tilt": 0.11246159672737122,
                "eye_direction": 0.48430362343788147,
                "phone_detected": 0
            },
            {
                "frame_index": 32,
                "head_x": 0.5011063814163208,
                "head_y": 0.5894070267677307,
                "neck_x": 0.5625212788581848,
                "neck_y": 0.4767180383205414,
                "shoulder_left_x": 0.8661043047904968,
                "shoulder_left_y": 1.0251870155334473,
                "shoulder_right_x": 0.14866186678409576,
                "shoulder_right_y": 0.9440310597419739,
                "elbow_left_x": 0.9715315103530884,
                "elbow_left_y": 1.6060837507247925,
                "elbow_right_x": -0.006922541651874781,
                "elbow_right_y": 1.6011372804641724,
                "wrist_left_x": 0.8869835734367371,
                "wrist_left_y": 1.9989343881607056,
                "wrist_right_x": 0.07725638151168823,
                "wrist_right_y": 1.9991854429244995,
                "head_tilt": 0.11268898844718933,
                "eye_direction": 0.48780208826065063,
                "phone_detected": 0
            }
        ],
        "phone_detected_percentage": 0.0,
        "head_tilt": 0.10974821249643961,
        "eye_direction": 0.48523975412050885,
}

# ‚úÖ Î™®Îç∏ ÏòàÏ∏° ÌÖåÏä§Ìä∏ Ïã§Ìñâ
def test_model_prediction():
    print("‚úÖ Î™®Îç∏ ÏòàÏ∏° ÌÖåÏä§Ìä∏ ÏãúÏûë")

    # ‚úÖ Î™®Îç∏ ÏòàÏ∏° Ïã§Ìñâ (üî• Ï†ÑÏ≤òÎ¶¨Îäî predict_focus ÎÇ¥Î∂ÄÏóêÏÑú ÏàòÌñâ)
    prediction, confidence = predict_focus(TEST_PAYLOAD)

    print(f"üì° Î™®Îç∏ ÏòàÏ∏° Í≤∞Í≥º: {prediction} (ÌôïÎ•†: {confidence:.4f})")

    # ‚úÖ [Ï†êÍ≤Ä] ÏòàÏ∏°Í∞íÏù¥ 0 ÎòêÎäî 1Ïù∏ÏßÄ ÌôïÏù∏
    assert prediction in [0, 1], "üö® ÏòàÏ∏°Í∞íÏù¥ 0 ÎòêÎäî 1Ïù¥ ÏïÑÎãò!"

if __name__ == "__main__":
    test_model_prediction()
